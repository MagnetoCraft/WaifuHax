package lol.waifuware.Modules.EXPLOITS;

import lol.waifuware.Events.OnTickEvent;
import lol.waifuware.Modules.AbstractModule;
import lol.waifuware.Modules.CATEGORY;
import lol.waifuware.Modules.Interfaces.Module;
import lol.waifuware.Util.ChatUtil;
import meteordevelopment.orbit.EventHandler;
import net.minecraft.client.MinecraftClient;
import net.minecraft.client.network.ClientPlayerEntity;
import net.minecraft.client.network.PlayerListEntry;
import net.minecraft.world.GameMode;

import java.util.HashMap;

@Module(name = "GamemodeDetector", key = 0, cat = CATEGORY.EXPLOIT)
public class GameModeDetector extends AbstractModule
{
    private HashMap<PlayerListEntry, GameMode> playerModMap = new HashMap<>();

    public GameModeDetector()
    {
        super();
        Create();
        desc[0] = "Detect when any player on the";
        desc[1] = "the server change their gamemode";
    }

    @EventHandler
    public void onTick(OnTickEvent e)
    {
        if(MinecraftClient.getInstance().world == null) return;
        if(MinecraftClient.getInstance().player == null) return;
        if(MinecraftClient.getInstance().isInSingleplayer()) return;

        ClientPlayerEntity player = MinecraftClient.getInstance().player;

        for (PlayerListEntry pl: player.networkHandler.getPlayerList())
        {
            if(playerModMap.containsKey(pl))
            {
                if(pl.getGameMode() != playerModMap.get(pl))
                {
                    if(pl.getProfile().getName() != null) {
                        ChatUtil.SendMessage(pl.getProfile().getName() + " changed their game mode from " + playerModMap.get(pl).getName() + " to " + pl.getGameMode().getName());
                        playerModMap.remove(pl);
                        playerModMap.put(pl, pl.getGameMode());
                    }
                }
            }else
            {
                if(pl.getProfile().getName() != null) {
                    ChatUtil.SendMessage("Added " + pl.getProfile().getName() + " to the online player list");
                }
                playerModMap.put(pl, pl.getGameMode());
            }
        }
    }
}
